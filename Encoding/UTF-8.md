### Incorrect string value: '\xF0\x9F\x92\x83' for column 'content' at row 1

最近项目中遭遇了这个MySQL的报错信息，具体情境是这样的：

  1. MySQL数据表charset=utf8，content字段类型 longtext
  2. 插入数据如下（简化版）: INSERT INTO tb_article(content) VALUES ('💃');
  3. 这个奇怪的符号是从网上爬取的文章内容中的一个emoji，然后插入到mysql文章信息表中

网上查到的资料给的解决方案是将 mysql 表的编码调整为 utf8-mb4，这样使mysql能够存储长度为4个字节的字符，再次执行类似的插入操作就不会报错了。
然后就产生了几个问题：

  1. mysql为什么不支持4字节字符？
  2. mysql中的utf8和utf8-mb4分别是什么？
  3. utf-8编码是怎么处理多字节字符的？

对于问题1和2下面有一段简短的解释，摘抄自网络：

---------
>MySQL数据库的 “utf8”并不是真正概念里的 UTF-8。
MySQL中的“utf8”编码只支持最大3字节每字符。真正的大家正在使用的UTF-8编码是应该能支持4字节每个字符。
MySQL的开发者没有修复这个bug。他们在2010年增加了一个变通的方法：一个新的字符集“utf8mb4”
当然，他们并没有对外公布（可能因为这个bug有点尴尬）。现在很多指南推荐用户使用“utf8”其实都错了。

>简单的说:
MySQL中的 “utf8mb4” 才是 真正意义上的“UTF-8”。
MySQL的“utf8”是个“特殊的字符编码”。这种编码很多Unicode字符保存不了。

转载处 : https://www.jianshu.com/p/ab9aa8d4df7d?openInApp=1

---------

看完这个解释之后应该有人会想吐槽mysql对utf-8的支持吧，不过这个解释又引入了一个新的问题：

  4. Unicode又是什么编码？

所以，我们现在有两个问题了，问题3和问题4，然而这两个问题其实就是字符集编码的问题，如果弄明白了字符编码，这两个问题就明白了，所以我们还剩下一个终极问题：

  1024. 计算机如何处理字符编码？？
  
  ---------------
  
  讨论字符编码首先需要知道的一些概念，他们分别是：ASCII，Unicode 和 UTF-8
  
  ####  ASCII（American Standard Code for Information Interchange，美国信息交换标准代码）
  
  >我们知道，计算机内部，所有信息最终都是一个二进制值。每一个二进制位（bit）有0和1两种状态，因此八个二进制位就可以组合出256种状态，这被称为一个字节（byte）。也就是说，一个字节一共可以用来表示256种不同的状态，每一个状态对应一个符号，就是256个符号，从00000000到11111111。

>上个世纪60年代，美国制定了一套字符编码，对英语字符与二进制位之间的关系，做了统一规定。这被称为 ASCII 码，一直沿用至今。

>ASCII 码一共规定了128个字符的编码，比如空格SPACE是32（二进制00100000），大写的字母A是65（二进制01000001）。这128个符号（包括32个不能打印出来的控制符号），只占用了一个字节的后面7位，最前面的一位统一规定为0。

>引用自：http://www.ruanyifeng.com/blog/2007/10/ascii_unicode_and_utf-8.html
 
ASCII只是编码了所有的英语字符，过了一段时间，欧洲国家的人们发现他们也需要给自己的字符编码才能让计算机显示出自己的文字，所以他们把ASCII最高位的0也利用起来，用来表示自己语言中的字符，这样就有256个字符可以表示（2的8次方），低7位的128个编码用来表示ASCII，剩下的128个编码用来表示别的字符，可是128个字符还是太少了，根本不够用，导致的问题就是ASCII之外的编码各自实现自己的，不考虑相互兼容，于是就存在了许多种编码方式，包括兼容ASCII的，和不兼容ASCII的。

又过了一段时间，亚洲语言使用者也参与了进来，这个时候问题就更复杂了，一个字节根本不够用，因为亚洲语言的字符太多了，超过了256个，不过这个问题很快就被解决了，因为多字节编码出现了，人们采用了2个字节来表示字符，当然，这个时候各个编码依然是没有考虑互相兼容的问题，那时候，世界上的众多编码同时存在，如果一个文件使用了不正确的编码打开就会变成乱码，因为两个字符编码集可能使用相同的二进制数字表示不同的符号，所以为了规范这些编码集，Unicode出现了。










